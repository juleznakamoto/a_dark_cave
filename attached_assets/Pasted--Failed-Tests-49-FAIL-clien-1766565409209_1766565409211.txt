
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 49 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 2. Multi-Device Conflicts > v1: should detect when cloud save is newer than local save - direct cloud priority
AssertionError: expected undefined to be 2000 // Object.is equality

- Expected: 
2000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:241:32
    239|       
    240|       expect(loaded).toBeDefined();
    241|       expect(loaded?.playTime).toBe(2000);
       |                                ^
    242|       expect(loaded?.resources.wood).toBe(200);
    243|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 2. Multi-Device Conflicts > v2: should detect when cloud save is newer - both saves present
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:261:26
    259|       const loaded = await loadGame();
    260|       
    261|       expect(loaded).not.toBeNull();
       |                          ^
    262|       expect(loaded?.playTime).toBe(2000);
    263|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 2. Multi-Device Conflicts > v3: should detect newer cloud save and sync locally
AssertionError: expected undefined to be 2000 // Object.is equality

- Expected: 
2000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:281:32
    279|       
    280|       expect(loaded).toBeDefined();
    281|       expect(loaded?.playTime).toBe(2000);
       |                                ^
    282|       // Verify it was saved locally
    283|       expect(mockPut).toHaveBeenCalledWith(

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 2. Multi-Device Conflicts > v4: should use cloud save when timestamps indicate it is newer
AssertionError: expected null to be truthy

- Expected: 
true

+ Received: 
null

 ❯ client/src/game/save.comprehensive.test.ts:306:22
    304|       const result = await loadGame();
    305|       
    306|       expect(result).toBeTruthy();
       |                      ^
    307|       expect(result?.playTime).toBe(2000);
    308|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 2. Multi-Device Conflicts > v5: should detect newer cloud save and process referrals
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:328:26
    326|       const loaded = await loadGame();
    327|       
    328|       expect(loaded).not.toBeNull();
       |                          ^
    329|       expect(loaded?.playTime).toBe(2000);
    330|       expect(loaded?.referrals).toBeDefined();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v1: should not lose offline progress - save then login
AssertionError: expected undefined to be 5000 // Object.is equality

- Expected: 
5000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:384:32
    382|       
    383|       expect(loaded).toBeDefined();
    384|       expect(loaded?.playTime).toBe(5000);
       |                                ^
    385|     });
    386| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v2: should preserve offline progress when authenticating
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:404:26
    402|       const loaded = await loadGame();
    403|       
    404|       expect(loaded).not.toBeNull();
       |                          ^
    405|       expect(loaded?.playTime).toBe(5000);
    406|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v3: should not lose offline progress - verify store persistence
AssertionError: expected undefined to be 5000 // Object.is equality

- Expected: 
5000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:427:32
    425|       const loaded = await loadGame();
    426|       
    427|       expect(loaded?.playTime).toBe(5000);
       |                                ^
    428|     });
    429| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v4: should preserve offline session through login
AssertionError: expected null to be truthy

- Expected: 
true

+ Received: 
null

 ❯ client/src/game/save.comprehensive.test.ts:448:22
    446|       const loaded = await loadGame();
    447|       
    448|       expect(loaded).toBeTruthy();
       |                      ^
    449|       expect(loaded?.playTime).toBe(5000);
    450|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v5: should sync offline progress to cloud on login
AssertionError: expected undefined to be 5000 // Object.is equality

- Expected: 
5000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:466:32
    464|       const loaded = await loadGame();
    465|       
    466|       expect(loaded?.playTime).toBe(5000);
       |                                ^
    467|       // Verify upload was attempted (or OCC error is acceptable)
    468|       expect(vi.mocked(auth.saveGameToSupabase).mock.calls.length).toBeG…

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v1: should preserve offline progress across sessions - simple
AssertionError: expected undefined to be 3000 // Object.is equality

- Expected: 
3000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:510:32
    508|       const loaded = await loadGame();
    509|       
    510|       expect(loaded?.playTime).toBe(3000);
       |                                ^
    511|     });
    512| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v2: should preserve offline progress - stay offline
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:529:26
    527|       const loaded = await loadGame();
    528|       
    529|       expect(loaded).not.toBeNull();
       |                          ^
    530|       expect(loaded?.playTime).toBe(3000);
    531|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v3: should preserve offline data with cooldowns across sessions
AssertionError: expected undefined to be 3000 // Object.is equality

- Expected: 
3000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:548:32
    546|       const loaded = await loadGame();
    547|       
    548|       expect(loaded?.playTime).toBe(3000);
       |                                ^
    549|       expect(loaded?.cooldownDurations).toBeDefined();
    550|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v4: should preserve offline progress through multiple sessions
AssertionError: expected undefined to be 3000 // Object.is equality

- Expected: 
3000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:560:32
    558|       await saveGame(createMockGameState({ playTime: 3000 }), true);
    559|       let loaded = await loadGame();
    560|       expect(loaded?.playTime).toBe(3000);
       |                                ^
    561| 
    562|       await saveGame(createMockGameState({ playTime: 4000 }), true);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 3. Offline Progress Overwrite > v5: should preserve offline progress - verify IndexedDB
AssertionError: expected undefined to be 3000 // Object.is equality

- Expected: 
3000

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:585:32
    583| 
    584|       const loaded = await loadGame();
    585|       expect(loaded?.playTime).toBe(3000);
       |                                ^
    586|     });
    587|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v1: should handle corrupted cooldownDurations - apply defaults
AssertionError: expected undefined to be defined
 ❯ client/src/game/save.comprehensive.test.ts:610:41
    608|       
    609|       expect(loaded).toBeDefined();
    610|       expect(loaded?.cooldownDurations).toBeDefined();
       |                                         ^
    611|       expect(typeof loaded?.cooldownDurations).toBe('object');
    612|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v2: should handle null cooldownDurations gracefully
AssertionError: expected undefined to be defined
 ❯ client/src/game/save.comprehensive.test.ts:632:41
    630|       const loaded = await loadGame();
    631|       
    632|       expect(loaded?.cooldownDurations).toBeDefined();
       |                                         ^
    633|     });
    634| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v3: should add cooldownDurations when missing
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:653:26
    651|       const loaded = await loadGame();
    652|       
    653|       expect(loaded).not.toBeNull();
       |                          ^
    654|       expect(loaded?.cooldownDurations).toBeDefined();
    655|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v4a: should handle corrupted cloud data with defaults
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:676:26
    674|       
    675|       // Should still load even with missing fields
    676|       expect(loaded).not.toBeNull();
       |                          ^
    677|       if (loaded) {
    678|         // cooldownDurations should exist (even if empty)

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v4b: should handle cloud data with null cooldownDurations
AssertionError: expected null to be truthy

- Expected: 
true

+ Received: 
null

 ❯ client/src/game/save.comprehensive.test.ts:698:22
    696|       const loaded = await loadGame();
    697|       
    698|       expect(loaded).toBeTruthy();
       |                      ^
    699|       if (loaded) {
    700|         expect(loaded.cooldownDurations).toBeDefined();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v4c: should sync corrupted cloud data locally with defaults
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:722:26
    720|       const loaded = await loadGame();
    721|       
    722|       expect(loaded).not.toBeNull();
       |                          ^
    723|       // Should have saved to local IndexedDB with defaults applied
    724|       expect(mockPut).toHaveBeenCalled();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 4. Data Corruption and Validation > v4e: should handle cloud data with explicitly undefined cooldownDurations
AssertionError: expected null not to be null
 ❯ client/src/game/save.comprehensive.test.ts:772:26
    770|       const loaded = await loadGame();
    771|       
    772|       expect(loaded).not.toBeNull();
       |                          ^
    773|       // Should have fixed the undefined value
    774|       if (loaded) {

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 6. Referral System Integration > v1: should not process claimed referrals - cloud load
AssertionError: expected undefined to be 100 // Object.is equality

- Expected: 
100

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:925:38
    923|       
    924|       expect(loaded).toBeDefined();
    925|       expect(loaded?.resources.gold).toBe(100);
       |                                      ^
    926|       expect(loaded?.referrals[0].claimed).toBe(true);
    927|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 6. Referral System Integration > v2: should not add gold for already claimed referrals
AssertionError: expected undefined to be 100 // Object.is equality

- Expected: 
100

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:947:38
    945|       const loaded = await loadGame();
    946|       
    947|       expect(loaded?.resources.gold).toBe(100);
       |                                      ^
    948|     });
    949| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 6. Referral System Integration > v3: should skip processing for claimed referrals
AssertionError: expected undefined to be 100 // Object.is equality

- Expected: 
100

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:967:38
    965|       const loaded = await loadGame();
    966|       
    967|       expect(loaded?.resources.gold).toBe(100);
       |                                      ^
    968|       // Should not have called saveGameToSupabase for referral processi…
    969|       const saveCallsForReferrals = vi.mocked(auth.saveGameToSupabase).m…

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 6. Referral System Integration > v4: should handle multiple claimed referrals without changes
AssertionError: expected undefined to be 100 // Object.is equality

- Expected: 
100

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:995:38
    993|       const loaded = await loadGame();
    994|       
    995|       expect(loaded?.resources.gold).toBe(100);
       |                                      ^
    996|       expect(loaded?.referrals.length).toBe(2);
    997|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 6. Referral System Integration > v5: should handle claimed referrals or empty array
AssertionError: expected undefined to be 100 // Object.is equality

- Expected: 
100

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:1016:38
    1014|       const loaded = await loadGame();
    1015|       
    1016|       expect(loaded?.resources.gold).toBe(100);
       |                                      ^
    1017|     });
    1018|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 7. PlayTime Tracking > v1: should preserve playTime - offline mode
AssertionError: expected undefined to be 12345 // Object.is equality

- Expected: 
12345

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:1033:32
    1031|       
    1032|       expect(loaded).toBeDefined();
    1033|       expect(loaded?.playTime).toBe(12345);
       |                                ^
    1034|     });
    1035| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 7. PlayTime Tracking > v2: should preserve playTime through cloud save
AssertionError: expected undefined to be 12345 // Object.is equality

- Expected: 
12345

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:1050:32
    1048|       const loaded = await loadGame();
    1049|       
    1050|       expect(loaded?.playTime).toBe(12345);
       |                                ^
    1051|     });
    1052| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[29/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 7. PlayTime Tracking > v3: should preserve playTime in local storage
AssertionError: expected undefined to be 12345 // Object.is equality

- Expected: 
12345

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:1068:32
    1066|       const loaded = await loadGame();
    1067|       
    1068|       expect(loaded?.playTime).toBe(12345);
       |                                ^
    1069|     });
    1070| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[30/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 7. PlayTime Tracking > v4: should preserve playTime across multiple cycles
AssertionError: expected undefined to be 12345 // Object.is equality

- Expected: 
12345

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:1079:32
    1077|       await saveGame(createMockGameState({ playTime: 12345 }), true);
    1078|       let loaded = await loadGame();
    1079|       expect(loaded?.playTime).toBe(12345);
       |                                ^
    1080| 
    1081|       await saveGame(createMockGameState({ playTime: 23456 }), true);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[31/49]⎯

 FAIL  client/src/game/save.comprehensive.test.ts > Save Game System - Comprehensive Tests > 7. PlayTime Tracking > v5: should preserve playTime through auth change
AssertionError: expected undefined to be 12345 // Object.is equality

- Expected: 
12345

+ Received: 
undefined

 ❯ client/src/game/save.comprehensive.test.ts:1101:32
    1099|       const loaded = await loadGame();
    1100|       
    1101|       expect(loaded?.playTime).toBe(12345);
       |                                ^
    1102|     });
    1103| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[32/49]⎯

 FAIL  client/src/game/save.logout.test.ts > Logout/Login Save Behavior Tests > User Reported Bug: Logout -> Offline Play -> Login > should preserve offline progress when logging back in (newer local)
AssertionError: expected undefined to be 7000 // Object.is equality

- Expected: 
7000

+ Received: 
undefined

 ❯ client/src/game/save.logout.test.ts:194:32
    192|       // CRITICAL ASSERTIONS
    193|       expect(loaded).toBeDefined();
    194|       expect(loaded?.playTime).toBe(7000); // Should use newer local pla…
       |                                ^
    195|       expect(loaded?.resources.wood).toBe(200); // Should use newer loca…
    196| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[33/49]⎯

 FAIL  client/src/game/save.logout.test.ts > Logout/Login Save Behavior Tests > User Reported Bug: Logout -> Offline Play -> Login > should handle cloud being newer than local (different device scenario)
AssertionError: expected undefined to be 8000 // Object.is equality

- Expected: 
8000

+ Received: 
undefined

 ❯ client/src/game/save.logout.test.ts:223:32
    221| 
    222|       expect(loaded).toBeDefined();
    223|       expect(loaded?.playTime).toBe(8000); // Should use cloud playTime
       |                                ^
    224|       expect(loaded?.resources.wood).toBe(300); // Should use cloud reso…
    225|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[34/49]⎯

 FAIL  client/src/game/save.logout.test.ts > Logout/Login Save Behavior Tests > User Reported Bug: Logout -> Offline Play -> Login > should handle equal playTime (use cloud as tiebreaker)
AssertionError: expected undefined to be 5000 // Object.is equality

- Expected: 
5000

+ Received: 
undefined

 ❯ client/src/game/save.logout.test.ts:246:32
    244| 
    245|       expect(loaded).toBeDefined();
    246|       expect(loaded?.playTime).toBe(5000);
       |                                ^
    247|       // When equal, cloud wins (safer choice)
    248|       expect(loaded?.resources.wood).toBe(150);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[35/49]⎯

 FAIL  client/src/game/save.logout.test.ts > Logout/Login Save Behavior Tests > User Reported Bug: Logout -> Offline Play -> Login > should handle OCC rejection gracefully when syncing local to cloud
AssertionError: expected undefined to be 7000 // Object.is equality

- Expected: 
7000

+ Received: 
undefined

 ❯ client/src/game/save.logout.test.ts:272:32
    270|       // Should still load local state even if cloud sync fails
    271|       expect(loaded).toBeDefined();
    272|       expect(loaded?.playTime).toBe(7000);
       |                                ^
    273|       expect(loaded?.resources.wood).toBe(200);
    274|     });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[36/49]⎯

 FAIL  client/src/game/save.logout.test.ts > Logout/Login Save Behavior Tests > User Reported Bug: Logout -> Offline Play -> Login > should preserve local state through multiple logout/login cycles
AssertionError: expected undefined to be 3000 // Object.is equality

- Expected: 
3000

+ Received: 
undefined

 ❯ client/src/game/save.logout.test.ts:301:32
    299|       const loaded = await loadGame();
    300| 
    301|       expect(loaded?.playTime).toBe(3000); // Latest local progress
       |                                ^
    302|     });
    303|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[37/49]⎯

 FAIL  client/src/game/save.logout.test.ts > Logout/Login Save Behavior Tests > Edge Cases > should handle very large playTime values
AssertionError: expected undefined to be 9007199254739991 // Object.is equality

- Expected: 
9007199254739991

+ Received: 
undefined

 ❯ client/src/game/save.logout.test.ts:349:32
    347|       const loaded = await loadGame();
    348| 
    349|       expect(loaded?.playTime).toBe(hugePlayTime);
       |                                ^
    350|     });
    351|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[38/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should add missing top-level fields without overwriting existing values
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:130:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[39/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should add missing nested fields in objects without overwriting existing nested values
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:154:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[40/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should not overwrite existing values with defaults
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:177:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[41/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should handle empty loaded state by returning all defaults
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:200:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[42/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should preserve arrays without merging them
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:215:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[43/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should handle null values correctly
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:235:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[44/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should add all new schema fields to old save data
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:251:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[45/49]⎯

 FAIL  client/src/game/save.mergeDefaults.test.ts > mergeWithDefaults - Missing Field Addition > should handle partial nested objects correctly
Error: Cannot find module './save'
Require stack:
- /home/runner/workspace/client/src/game/save.mergeDefaults.test.ts
 ❯ getMergeWithDefaults client/src/game/save.mergeDefaults.test.ts:96:24
     94|   // Import mergeWithDefaults by executing the function in save.ts
     95|   const getMergeWithDefaults = () => {
     96|     const saveModule = require('./save');
       |                        ^
     97|     // Access the private function through module scope
     98|     const mergeWithDefaults = (loadedState: Partial<GameState>): GameSta…
 ❯ client/src/game/save.mergeDefaults.test.ts:276:31

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[46/49]⎯

 FAIL  client/src/game/save.test.ts > Game Save/Load > should preserve cooldowns after save/load cycle
AssertionError: expected undefined to deeply equal { gatherWood: 5, buildHut: 10 }

- Expected: 
{
  "buildHut": 10,
  "gatherWood": 5,
}

+ Received: 
undefined

 ❯ client/src/game/save.test.ts:43:31
     41|     const loaded = await loadGame();
     42| 
     43|     expect(loaded?.cooldowns).toEqual(gameState.cooldowns);
       |                               ^
     44|     expect(loaded?.cooldownDurations).toEqual(gameState.cooldownDuration…
     45|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[47/49]⎯

 FAIL  client/src/game/save.test.ts > Game Save/Load > should handle corrupted save data gracefully
AssertionError: expected undefined to be defined
 ❯ client/src/game/save.test.ts:61:39
     59|     // Should return the corrupted data with defaults applied, not null
     60|     expect(loaded).toBeDefined();
     61|     expect(loaded?.cooldownDurations).toBeDefined();
       |                                       ^
     62|   });
     63| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[48/49]⎯

 FAIL  client/src/game/save.test.ts > Game Save/Load > should merge cloud save with local save correctly
AssertionError: expected undefined to be 150 // Object.is equality

- Expected: 
150

+ Received: 
undefined

 ❯ client/src/game/save.test.ts:95:36
     93| 
     94|     const loaded = await loadGame();
     95|     expect(loaded?.resources.wood).toBe(150); // Cloud should win
       |                                    ^
     96|   });
     97| });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[49/49]⎯


 Test Files  4 failed | 21 passed (25)
      Tests  49 failed | 351 passed (400)
   Start at  08:36:04
   Duration  6.17s (transform 2.09s, setup 0ms, import 4.24s, tests 2.78s, environment 9ms)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
