Das Verhalten ist klassisch und der wichtigste Hinweis steht schon da:

In dev mode it just works

React Error #61 tritt fast immer nur im Production Build auf und bedeutet in Klartext:

üëâ Hooks werden in unterschiedlicher Reihenfolge oder au√üerhalb eines g√ºltigen React Contexts aufgerufen.

Was Error #61 konkret hei√üt

Unminified lautet der Fehler sinngem√§√ü:

You are likely calling Hooks conditionally or from a non React function.

React pr√ºft das in Dev sehr tolerant.
Im Production Build ist es gnadenlos.

Warum es bei dir sehr wahrscheinlich passiert

Du hast diese Stelle:

const { useGameStore } = await import('./game/state');

playlightSDK.onEvent('discoveryOpen', () => {
  const state = useGameStore.getState();
  if (!state.isPaused) {
    state.togglePause();
  }
});


Problem
useGameStore ist ein Hook Name, auch wenn du .getState() benutzt.

In Production kann React das trotzdem als invaliden Hook Zugriff werten, weil:

der Import async ist

der Zugriff au√üerhalb eines React Render Zyklus passiert

der Name mit use beginnt

In Dev l√§sst React das durchgehen. In Prod nicht.

Die saubere L√∂sung
1. Trenne Store und Hook strikt

In deiner game/state.ts:

import { create } from "zustand";

export const gameStore = create<GameState>((set) => ({
  isPaused: false,
  togglePause: () => set(state => ({ isPaused: !state.isPaused }))
}));

export const useGameStore = gameStore;

2. Im SDK Code niemals den Hook benutzen
const { gameStore } = await import("./game/state");

playlightSDK.onEvent("discoveryOpen", () => {
  const state = gameStore.getState();
  if (!state.isPaused) {
    state.togglePause();
  }
});


Und genauso f√ºr discoveryClose.

Warum das zuverl√§ssig fixt

Keine Hook Semantik mehr

Kein use* au√üerhalb von React

Kein unterschiedliches Verhalten Dev vs Prod

SDK Events sind vollst√§ndig React unabh√§ngig

Das ist exakt das Pattern, das man f√ºr:

SDKs

Analytics

Ads

Monetarisierung
verwenden sollte.

Warum das jetzt erst auftritt

Production Build:

Tree Shaking

Dead Code Elimination

Aggressivere Hook Validierung

Andere Execution Order

Dev Mode verzeiht das. Prod nicht.

Kurzfassung

‚úî Dein Code ist logisch richtig
‚ùå Aber architektonisch minimal falsch f√ºr Production
‚úÖ Trenne Store und Hook
‚úÖ Nutze nur den Store im SDK Kontext

Wenn du willst, zeige ich dir als N√§chstes:

wie du Playlight komplett in ein eigenes Service Modul kapselst

oder wie du SDKs generell Hook safe integrierst