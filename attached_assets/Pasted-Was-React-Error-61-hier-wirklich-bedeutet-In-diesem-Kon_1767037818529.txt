Was React Error #61 hier wirklich bedeutet

In diesem Kontext heiÃŸt #61 fast immer:

Ein Hook wird ausgefÃ¼hrt, wÃ¤hrend React noch keinen gÃ¼ltigen Dispatcher hat

Und das passiert typischerweise bei:

lazy oder dynamischem Import

Charts (Recharts!)

Komponenten, die conditional gerendert werden

Hydration Timing Unterschiede zwischen dev und prod

Dev Mode ist langsamer, strikter und stabilisiert die Reihenfolge.
Prod ist schneller, aggressiver, weniger verzeihend.

Warum Recharts der Trigger ist

Recharts nutzt intern:

useLayoutEffect

useRef

Contexts

ResizeObserver

Wenn du Recharts deferred oder conditional lÃ¤dst und dabei nicht sofort renderst, kann folgendes passieren:

if (!isVisible) return null;

const Chart = lazy(() => import("recharts"));


oder

const Chart = condition
  ? lazy(() => import("recharts"))
  : null;


ğŸ‘‰ Hook Order bricht in Prod, Dev kaschiert es.

Der klassische Fehler

Sehr hÃ¤ufig sieht es so aus:

if (typeof window === "undefined") return null;

const Chart = lazy(() => import("recharts"));


oder

if (!mounted) {
  return null;
}

return <Chart />;


Hooks laufen dann nicht konsistent.

Die saubere, produktionssichere LÃ¶sung
Regel 1

lazy() niemals bedingt aufrufen

âŒ falsch

if (showChart) {
  const Chart = lazy(() => import("./Chart"));
}


âœ… richtig

const Chart = lazy(() => import("./Chart"));

return showChart ? <Chart /> : null;

Regel 2

Recharts nur in einer eigenen Wrapper Component

Mach einen harten Isolations Layer.

const ChartWrapper = lazy(() => import("./ChartWrapper"));


ChartWrapper.tsx

import { ResponsiveContainer, LineChart, Line } from "recharts";

export default function ChartWrapper() {
  return (
    <ResponsiveContainer width="100%" height={300}>
      <LineChart data={data}>
        <Line dataKey="value" />
      </LineChart>
    </ResponsiveContainer>
  );
}


ğŸ‘‰ Keine Bedingungen, keine Fenster Checks, kein Early Return.

Regel 3

Suspense MUSS direkt Ã¼ber dem Chart liegen

<Suspense fallback={<div>Loading chart...</div>}>
  {showChart && <ChartWrapper />}
</Suspense>


Nicht hÃ¶her, nicht tiefer.

Warum es nur im Dashboard knallt

Dashboard ist der einzige Ort mit Recharts

Recharts ist hook intensiv

Deferred Loading verschiebt Hook Reihenfolge

Prod optimiert aggressiv

Boom

Schneller Debug Check

Mach testweise:

import ChartWrapper from "./ChartWrapper";


ohne lazy.

Wenn der Fehler weg ist, ist der Beweis erbracht.

TL;DR

âœ” Dev Mode funktioniert
âœ” Prod Mode crasht
âœ” Recharts + lazy + conditional render
âŒ Hook Order bricht

Fix

lazy immer top level

Chart isolieren

Suspense direkt drÃ¼ber

Keine Bedingungen im Chart selbst

Wenn du willst, poste den Dashboard Component Code, dann sage ich dir exakt welche Zeile den Crash verursacht.