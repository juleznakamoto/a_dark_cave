The reason is purely state logic and component structure, not Stripe.

You are rendering two dialogs at the same time, both controlled by different conditions, and the Shop dialog never actually closes.

What is happening

ShopDialog is always rendered with
open={isOpen}
This never changes when you start a payment.

When you click Purchase, you set
setClientSecret(clientSecret)
but you do not close the Shop dialog.

Because of that:

The Shop dialog stays open

The Payment dialog opens on top of it

Hiding logic inside the Shop dialog content does not matter, because the dialog itself is still mounted and visible

This part is the core problem:

<Dialog open={isOpen} onOpenChange={onClose}>


isOpen never depends on clientSecret.

Why conditional rendering inside does not fix it

This condition:

{!isLoading && !clientSecret ? (
  <Tabs>...</Tabs>
) : (
  <PaymentSection />
)}


only switches content, not the dialog container itself.

So even if you hide the shop UI, the dialog overlay and layout remain active.

Correct mental model

You currently have:

Shop dialog controlled by isOpen

Payment dialog controlled by clientSecret

But what you actually want is:

Shop dialog closed when payment starts

Payment dialog opened instead

Minimal fix option (recommended)

Close the shop dialog when starting payment.

Inside handlePurchaseClick for paid items:

setClientSecret(clientSecret);
setSelectedItem(itemId);
onClose(); // hide shop dialog


Now:

Shop dialog closes

Payment dialog opens cleanly

Alternative cleaner architecture

Instead of two dialogs, use one dialog with a mode:

type DialogMode = "shop" | "payment";


And switch the dialog content based on mode.

This avoids stacking dialogs entirely and prevents z index bugs, focus traps, scroll locking issues, etc.

Why your current setup feels buggy

Stacking dialogs causes:

Backdrop overlap

Focus not moving correctly

Scroll locking conflicts

Clicks leaking to the underlying dialog

Even if it looks acceptable now, it will break on mobile or Safari.

Summary

The shop dialog is not hidden because:

Its open prop never changes

You only change internal content, not dialog visibility

You are opening a second dialog instead of closing the first

Closing the shop dialog when starting payment is the correct fix.