  if (key === "watchtower") {
        const level = value ?? 0;
        const watchtowerLabels = ["Watchtower", "Guard Tower", "Fortified Tower", "Cannon Tower"];
        label = watchtowerLabels[level - 1] || "Watchtower";
        
        const isDamaged = story?.seen?.watchtowerDamaged;
        const multiplier = isDamaged ? 0.5 : 1;
        
        let defense = 0;
        let attack = 0;
        let integrity = 0;
        
        for (let i = 1; i <= level; i++) {
          defense += 1 + (i - 1);
          attack += 4 * i;
        }
        
        // Calculate integrity based on level
        integrity = 5; // Level 1
        if (level >= 2) integrity += 5; // Level 2
        if (level >= 3) integrity += 10; // Level 3
        if (level >= 4) integrity += 10; // Level 4
        
        // Apply damage multiplier and round down
        defense = Math.floor(defense * multiplier);
        attack = Math.floor(attack * multiplier);
        integrity = Math.floor(integrity * multiplier);
        
        tooltip = `+${defense} Defense\n+${attack} Attack\n+${integrity} Integrity`;
        
        // Add red down arrow if damaged
        if (isDamaged) {
          label += " ↓";
        }
      } else if (key === "bastion") {
        const isDamaged = story?.seen?.bastionDamaged;
        const multiplier = isDamaged ? 0.5 : 1;
        
        const defense = Math.floor(5 * multiplier);
        const attack = Math.floor(3 * multiplier);
        const integrity = Math.floor(20 * multiplier);
        
        tooltip = `+${defense} Defense\n+${attack} Attack\n+${integrity} Integrity`;
        
        // Add red down arrow if damaged
        if (isDamaged) {
          label += " ↓";
        }
      } else if (key === "palisades") {
        const palisadesLevel = value ?? 0;
        const palisadesLabels = ["Wooden Palisades", "Fortified Palisades", "Stone Wall", "Reinforced Wall"];
        label = palisadesLabels[palisadesLevel - 1] || "Wooden Palisades";
        
        const isDamaged = story?.seen?.palisadesDamaged;
        const multiplier = isDamaged ? 0.5 : 1;
        
        let defense = 0;
        let integrity = 0;
        
        if (palisadesLevel >= 1) {
          defense += 4;
          integrity += 10;
        }
        if (palisadesLevel >= 2) {
          defense += 6;
          integrity += 15;
        }
        if (palisadesLevel >= 3) {
          defense += 8;
          integrity += 25;
        }
        if (palisadesLevel >= 4) {
          defense += 10;
          integrity += 35;
        }
        
        // Apply damage multiplier and round down
        defense = Math.floor(defense * multiplier);
        integrity = Math.floor(integrity * multiplier);
        
        tooltip = `+${defense} Defense\n+${integrity} Integrity`;
        
        // Add red down arrow if damaged
        if (isDamaged) {
          label += " ↓";
        }