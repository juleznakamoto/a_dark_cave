
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 17 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯

 FAIL  client/src/game/loop.resourceLimits.test.ts > Game Loop - Resource Limits Integration > Storage Upgrade Effects > should increase limit when storage is upgraded
AssertionError: expected 2500 to be 3000 // Object.is equality

- Expected
+ Received

- 3000
+ 2500

 ❯ client/src/game/loop.resourceLimits.test.ts:219:54
    217|       // Now production can go higher
    218|       store.updateResource('wood', 2000);
    219|       expect(useGameStore.getState().resources.wood).toBe(3000);
       |                                                      ^
    220|       
    221|       // But not above new limit

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/17]⎯

 FAIL  client/src/game/loop.resourceLimits.test.ts > Game Loop - Resource Limits Integration > Storage Upgrade Effects > should handle all storage tiers correctly
AssertionError: expected 2500 to be 5000 // Object.is equality

- Expected
+ Received

- 5000
+ 2500

 ❯ client/src/game/loop.resourceLimits.test.ts:264:56
    262|         
    263|         // Should be capped at limit
    264|         expect(useGameStore.getState().resources.wood).toBe(limit);
       |                                                        ^
    265|       });
    266|     });
 ❯ client/src/game/loop.resourceLimits.test.ts:238:13

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Core Functionality > getResourceLimit > should return 5000 for Storehouse (level 2)
AssertionError: expected 2500 to be 5000 // Object.is equality

- Expected
+ Received

- 5000
+ 2500

 ❯ client/src/game/resourceLimits.test.ts:35:39
     33|     it('should return 5000 for Storehouse (level 2)', () => {
     34|       state.buildings.storehouse = 1;
     35|       expect(getResourceLimit(state)).toBe(5000);
       |                                       ^
     36|     });
     37| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Core Functionality > getResourceLimit > should return 10000 for Fortified Storehouse (level 3)
AssertionError: expected 5000 to be 10000 // Object.is equality

- Expected
+ Received

- 10000
+ 5000

 ❯ client/src/game/resourceLimits.test.ts:40:39
     38|     it('should return 10000 for Fortified Storehouse (level 3)', () => {
     39|       state.buildings.fortifiedStorehouse = 1;
     40|       expect(getResourceLimit(state)).toBe(10000);
       |                                       ^
     41|     });
     42| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Core Functionality > getResourceLimit > should return 25000 for Village Warehouse (level 4)
AssertionError: expected 10000 to be 25000 // Object.is equality

- Expected
+ Received

- 25000
+ 10000

 ❯ client/src/game/resourceLimits.test.ts:45:39
     43|     it('should return 25000 for Village Warehouse (level 4)', () => {
     44|       state.buildings.villageWarehouse = 1;
     45|       expect(getResourceLimit(state)).toBe(25000);
       |                                       ^
     46|     });
     47| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Core Functionality > getResourceLimit > should return 50000 for Grand Repository (level 5)
AssertionError: expected 25000 to be 50000 // Object.is equality

- Expected
+ Received

- 50000
+ 25000

 ❯ client/src/game/resourceLimits.test.ts:50:39
     48|     it('should return 50000 for Grand Repository (level 5)', () => {
     49|       state.buildings.grandRepository = 1;
     50|       expect(getResourceLimit(state)).toBe(50000);
       |                                       ^
     51|     });
     52| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Core Functionality > getResourceLimit > should return 100000 for Great Vault (level 6)
AssertionError: expected 50000 to be 100000 // Object.is equality

- Expected
+ Received

- 100000
+ 50000

 ❯ client/src/game/resourceLimits.test.ts:55:39
     53|     it('should return 100000 for Great Vault (level 6)', () => {
     54|       state.buildings.greatVault = 1;
     55|       expect(getResourceLimit(state)).toBe(100000);
       |                                       ^
     56|     });
     57| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Core Functionality > getStorageLimitText > should return formatted number for storage level 3
AssertionError: expected '5,000' to be '10,000' // Object.is equality

Expected: "10,000"
Received: "5,000"

 ❯ client/src/game/resourceLimits.test.ts:145:42
    143|     it('should return formatted number for storage level 3', () => {
    144|       state.buildings.fortifiedStorehouse = 1;
    145|       expect(getStorageLimitText(state)).toBe('10,000');
       |                                          ^
    146|     });
    147| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Integration with Game Components > Storage Building Upgrades > should increase limit when upgrading storage
AssertionError: expected 2500 to be 5000 // Object.is equality

- Expected
+ Received

- 5000
+ 2500

 ❯ client/src/game/resourceLimits.test.ts:398:39
    396|       
    397|       state.buildings.storehouse = 1; // 5000 limit (overrides supplyHut)
    398|       expect(getResourceLimit(state)).toBe(5000);
       |                                       ^
    399|       
    400|       // Resources above old limit but below new limit should be allowed

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Integration with Game Components > Storage Building Upgrades > should cap at new limit after upgrade
AssertionError: expected 5000 to be 10000 // Object.is equality

- Expected
+ Received

- 10000
+ 5000

 ❯ client/src/game/resourceLimits.test.ts:410:40
    408|       state.resources.stone = 9500;
    409|       const updates = updateResource(state, 'stone', 1000);
    410|       expect(updates.resources?.stone).toBe(10000);
       |                                        ^
    411|     });
    412| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Integration with Game Components > Storage Building Upgrades > should allow accumulation up to each storage tier
AssertionError: expected 2500 to be 5000 // Object.is equality

- Expected
+ Received

- 5000
+ 2500

 ❯ client/src/game/resourceLimits.test.ts:436:41
    434|         Object.assign(state.buildings, buildings);
    435|         
    436|         expect(getResourceLimit(state)).toBe(limit);
       |                                         ^
    437|       });
    438|     });
 ❯ client/src/game/resourceLimits.test.ts:424:13

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/17]⎯

 FAIL  client/src/game/resourceLimits.test.ts > Resource Limits - Integration with Game Components > Edge Cases and Boundary Conditions > should handle very large production amounts
AssertionError: expected 50000 to be 100000 // Object.is equality

- Expected
+ Received

- 100000
+ 50000

 ❯ client/src/game/resourceLimits.test.ts:471:39
    469|       state.buildings.greatVault = 1;
    470|       const updates = updateResource(state, 'wood', 150000);
    471|       expect(updates.resources?.wood).toBe(100000);
       |                                       ^
    472|     });
    473|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/17]⎯

 FAIL  client/src/game/state.resourceLimits.test.ts > State - Resource Limits Integration > Storage upgrade scenarios > should allow accumulation above old limit after storage upgrade
AssertionError: expected 2500 to be 3000 // Object.is equality

- Expected
+ Received

- 3000
+ 2500

 ❯ client/src/game/state.resourceLimits.test.ts:211:54
    209|       // Now can add more
    210|       store.updateResource('wood', 2000);
    211|       expect(useGameStore.getState().resources.wood).toBe(3000);
       |                                                      ^
    212| 
    213|       // But still capped at new limit

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/17]⎯

 FAIL  client/src/game/state.resourceLimits.test.ts > State - Resource Limits Integration > Storage upgrade scenarios > should handle all storage tiers correctly
AssertionError: expected 2500 to be 5000 // Object.is equality

- Expected
+ Received

- 5000
+ 2500

 ❯ client/src/game/state.resourceLimits.test.ts:288:56
    286| 
    287|         // Should be capped exactly at limit
    288|         expect(useGameStore.getState().resources.iron).toBe(limit);
       |                                                        ^
    289|       });
    290|     });
 ❯ client/src/game/state.resourceLimits.test.ts:230:13

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/17]⎯

 FAIL  client/src/game/rules/actionEffects.test.ts > Building Cost Reductions > should apply fortified storehouse 5% building discount for buildCabin
AssertionError: expected +0 to be 8 // Object.is equality

- Expected
+ Received

- 8
+ 0

 ❯ client/src/game/rules/actionEffects.test.ts:219:41
    217|     const expectedWoodCost = Math.floor(baseWoodCost * 0.95); // 142
    218|     const expectedStoneCost = Math.floor(baseStoneCost * 0.95); // 47
    219|     expect(updatesWith.resources!.wood).toBe(baseWoodCost - expectedWoodCost); …
       |                                         ^
    220|     expect(updatesWith.resources!.stone).toBe(baseStoneCost - expectedStoneCost…
    221|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/17]⎯

 FAIL  client/src/game/rules/actionEffects.test.ts > Cost Reduction Edge Cases > should floor discount calculations correctly for building
AssertionError: expected +0 to be 8 // Object.is equality

- Expected
+ Received

- 8
+ 0

 ❯ client/src/game/rules/actionEffects.test.ts:404:37
    402|     const expectedWoodCost = Math.floor(baseWoodCost * 0.95);
    403|     const expectedStoneCost = Math.floor(baseStoneCost * 0.95);
    404|     expect(updates.resources!.wood).toBe(baseWoodCost - expectedWoodCost);
       |                                     ^
    405|     expect(updates.resources!.stone).toBe(baseStoneCost - expectedStoneCost);
    406|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/17]⎯

 FAIL  client/src/game/rules/resourceGains.test.ts > Resource Gain Tests > Building Cost Reductions > fortified storehouse reduces building costs correctly
AssertionError: expected 150 to be 142 // Object.is equality

- Expected
+ Received

- 142
+ 150

 ❯ client/src/game/rules/resourceGains.test.ts:562:45
    560|       // Fortified Storehouse: 5% building cost reduction
    561|       const amountWithFortifiedStorehouse = parseInt(woodCostWithFortifiedStore…
    562|       expect(amountWithFortifiedStorehouse).toBe(Math.floor(amountWithout * 0.9…
       |                                             ^
    563|     });
    564|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/17]⎯


 Test Files  5 failed | 18 passed (23)
      Tests  17 failed | 352 passed (369)
   Start at  08:45:30
   Duration  5.99s (transform 2.21s, setup 0ms, import 4.30s, tests 2.66s, environment 4ms)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
