Right now the Shop dialog cannot reopen, because:

The Shop dialog visibility is controlled only by the isOpen prop from the parent

When payment starts, you correctly call onClose()

When payment is cancelled or the X is clicked, nothing tells the parent to reopen the shop

Setting clientSecret to null is not enough, because the Shop dialog does not depend on it.

What is actually happening

Flow today:

Shop opens (isOpen = true)

Purchase clicked

setClientSecret(...)

onClose() → parent sets isOpen = false

Payment dialog opens (local state)

Cancel or X clicked

setClientSecret(null)

BUT isOpen is still false

Shop stays closed forever

So the Shop dialog never comes back.

Correct fix: explicitly reopen the Shop dialog

You need a way to tell the parent to open the shop again.

Option A (clean and recommended): add onOpen callback
1️⃣ Change props
interface ShopDialogProps {
  isOpen: boolean;
  onClose: () => void;
  onOpen: () => void;
}

2️⃣ Use it when canceling payment
const handleCancelPayment = () => {
  setClientSecret(null);
  setSelectedItem(null);
  onOpen(); // reopen shop
};

3️⃣ Also handle the X button on payment dialog

Right now this blocks closing:

<Dialog open={true} onOpenChange={(open) => { if (!open) return; }}>


Replace it with:

<Dialog
  open={true}
  onOpenChange={(open) => {
    if (!open) {
      handleCancelPayment();
    }
  }}
>


Now:

Clicking X

Pressing ESC

Clicking Cancel

all behave the same.

Important: remove misleading comment

This comment is incorrect and will confuse you later:

// Reopen the shop dialog
// Note: we don't call onClose() here, the dialog will reopen naturally


It will never reopen naturally.
State must be explicitly lifted.

Optional but cleaner architecture (future refactor)

Long term, the best design is:

type ShopMode = "shop" | "payment";


Single Dialog, switch content based on mode.

This avoids:

Double backdrops

Focus traps

z index stacking

Mobile Safari bugs

But your current solution is totally fine once the reopen is explicit.

Summary

Why it broke:

Shop dialog is parent controlled

Payment cancel only changed local state

Parent never reopened the shop

What fixes it:

Add onOpen

Call it when payment dialog closes

Wire onOpenChange of payment dialog to cancel logic